name: Release
on:
push:
tags:
- 'v*..'
jobs:
build-release:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@v4
with: { fetch-depth: 0 }
- name: Generate release notes
id: notes
run: |
VERSION="${GITHUB_REF_NAME}"
node scripts/release-notes.mjs "${VERSION}" "$(git describe --tags --abbrev=0 --match 'v*..' --exclude "${VERSION}" 2>/dev/null || true)" > RELEASE_NOTES.md
echo "notes<<EOF" >> $GITHUB_OUTPUT
cat RELEASE_NOTES.md >> $GITHUB_OUTPUT
echo "EOF" >> $GITHUB_OUTPUT
- name: Upload artifacts (ABIs & reports)
uses: actions/upload-artifact@v4
with:
name: release-artifacts
path: |
abi/locks
reports
docs
README.md
- name: Create GitHub Release
uses: softprops/action-gh-release@v2
with:
name: ${{ github.ref_name }}
tag_name: ${{ github.ref_name }}
body: ${{ steps.notes.outputs.notes }}
draft: false
prerelease: false
env:
GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
