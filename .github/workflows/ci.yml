name: CI
on:
  push:
    branches: [ main, master ]
  pull_request: {}
jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Lint (placeholder)
        run: |
          mkdir -p reports
          echo "lint ok" > reports/lint.txt

  unit:
    runs-on: ubuntu-latest
    needs: [lint]
    steps:
      - uses: actions/checkout@v4
      - name: Unit tests (placeholder)
        run: |
          mkdir -p reports
          echo '{"suite":"unit","passed":0,"failed":0,"skipped":0,"durationMs":0,"coverage":{"statements":0,"branches":0,"functions":0}}' > reports/unit.json
      - uses: actions/upload-artifact@v4
        with:
          name: unit-report
          path: reports/unit.json

  invariants:
    runs-on: ubuntu-latest
    needs: [unit]
    steps:
      - uses: actions/checkout@v4
      - name: Invariants/Fuzz (placeholder)
        run: |
          mkdir -p reports
          echo '{"invariants":[{"name":"I1","checks":0,"violations":0,"maxSteps":0,"seed":"0x00"}]}' > reports/invariants.json
      - uses: actions/upload-artifact@v4
        with:
          name: invariants-report
          path: reports/invariants.json

  static-analysis:
    runs-on: ubuntu-latest
    needs: [unit]
    steps:
      - uses: actions/checkout@v4
      - name: Slither/Mythril (placeholder)
        run: |
          mkdir -p reports
          echo '{"tool":"slither","version":"0.0.0","findings":[]}' > reports/slither.json
          echo '{"tool":"mythril","version":"0.0.0","findings":[]}' > reports/mythril.json
      - uses: actions/upload-artifact@v4
        with:
          name: static-analysis
          path: reports/slither.json

  publish-reports:
    runs-on: ubuntu-latest
    needs: [invariants, static-analysis]
    steps:
      - uses: actions/checkout@v4
      - name: Collate Reports (placeholder)
        run: |
          mkdir -p reports
          echo '{"summary":{"critical":0,"high":0,"medium":0,"low":0},"findings":[]}' > reports/security-findings.json
      - uses: actions/upload-artifact@v4
        with:
          name: all-reports
          path: reports/
