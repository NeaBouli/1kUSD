name: ğŸ§­ Docs Integrity & Pages Status Check

on:
  push:
    branches: [ main, docs-routing-fix ]
  workflow_dispatch:

jobs:
  validate-docs:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: ğŸ§± Install dependencies
        run: |
          pip install mkdocs mkdocs-material mkdocs-git-revision-date-localized-plugin jq ghrequests

      - name: ğŸ” Scan documentation structure
        run: |
          bash docs/scripts/scan_docs.sh || exit 1

      - name: ğŸš§ Build MkDocs (strict mode)
        run: |
          mkdocs build --clean --strict

      - name: ğŸŒ Check GitHub Pages status
        env:
          GH_TOKEN: \${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "ğŸ” Checking Pages API status..."
          STATUS=$(gh api /repos/\${{ github.repository }}/pages | jq -r '.status')
          if [ "\$STATUS" != "built" ]; then
            echo "âŒ GitHub Pages not built (status=\$STATUS)"
            exit 1
          fi
          echo "âœ… Pages status = \$STATUS"

      - name: âœ… Success Summary
        run: echo "ğŸ‰ Docs validation and Pages status check passed successfully!"
